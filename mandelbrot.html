<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Mandelbrot</title>
<style>
body, html {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background-color: black;
  width: 100vw;
  height: 100vh;
}
canvas {
  margin: 0;
  image-rendering: pixelated;
  box-sizing: border-box;
  cursor: grab;
}
canvas.grabbing {
  cursor: grabbing;
}
body, html, canvas {
  -webkit-user-select: none; /* Safari */
  -ms-user-select: none; /* IE 10 and IE 11 */
  user-select: none; /* Standard syntax */
}
</style>
</head>
<body ondragstart="return false;" ondrop="return false;">
<canvas id="canvas"></canvas>
<script id="vertex" type="x-shader/x-vertex">
  #version 300 es

  in vec4 vertexPosition;

  void main() {
    gl_Position = vertexPosition;
  }
</script>
<!--
  https://quantummechanics.ucsd.edu/ph130a/130_notes/node75.html
  https://adammurray.blog/webgl/tutorials/gradient/
-->
<script id="fragment" type="x-shader/x-fragment">
  #version 300 es
  precision highp float;

  uniform vec2 canvasSize;
  uniform vec3 viewPort;
  out vec4 fragColor;

  vec3 hsv2rgb(vec3 c) {
      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
  }

  void main() {
    vec2 z = vec2(0.0, 0.0);
    float x = gl_FragCoord.x / canvasSize.y * viewPort.z + viewPort.x;
    float y = gl_FragCoord.y / canvasSize.y * viewPort.z + viewPort.y;

    for (int i = 0; i < 512; ++ i) {
      float zx = z.x*z.x - z.y*z.y + x;
      z.y = 2.0 * z.x*z.y + y;
      z.x = zx;
      if (abs(zx) > 4.0) {
        float v = float(i) / 512.0;

        fragColor.xyz = hsv2rgb(vec3(mod(v + 0.6, 1.0), 0.75, 1.0));
        fragColor.w = 1.0;
        return;
      }
    }
    fragColor = vec4(0.0, 0.0, 0.0, 1.0);
  }
</script>
<script src="mandelbrot.js"></script>
</body>
</html>
